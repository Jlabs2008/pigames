# Imports
import keyboard as k
import os
import time as t
import mmap
import sys
import tkinter as tk

# Gathers the digits
def digit_gather(pi_file):
    print("Translating")
    # Check if file exists before trying to open it
    if not os.path.exists(pi_file):
        print("File not found, file might be corupted.")
    
    with open(pi_file, 'rb') as f:
        # Memory map the file - this doesn't load it all into RAM
        mmapped_file = mmap.mmap(f.fileno(), 0, access=mmap.ACCESS_READ)
    return mmapped_file

def get_pi_digit(pi_map, position):
    actual_position = position + 2
    # Make sure position is within bounds
    if actual_position >= pi_map.size():
        print("Reached end of file. Restarting from beginning.")
        actual_position = 2 
    
    # Get the character at the position
    pi_map.seek(actual_position)
    digit = pi_map.read(1).decode('utf-8')
    # Skip any non-digit characters that might be in the file
    while not digit.isdigit() and actual_position < pi_map.size():
        actual_position += 1
        pi_map.seek(actual_position)
        digit = pi_map.read(1).decode('utf-8')
    return digit

def keytest():
    k.press_and_release('q, w, e, r, t, y, u, i, o, p, a, s, d, f, g, h, j, k, l, z, x, c, v, b, n, m, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0')
    if k.is_pressed('a'):  # Using is_pressed to check a key as an example
        print("Success")
    else:
        print("Incompatible keyboard layout. Please ensure that this is running with an EN-US keyboard.")

def start():
    global current_position
    print("Starting...")
    
    # Setup escape key before the sleep
    k.add_hotkey('esc', lambda: sys.exit())
    
    # First sleep
    print(f"Waiting for 20 seconds before checking digits...")
    t.sleep(20)  # Removed quotes - this should be a number, not a string
    
    # Start checking digits
    while True:
        pi_digit = get_pi_digit(pi_map, current_position)
        print(f"Position {current_position}: Digit is {pi_digit}")
        current_position += 1  # Increment position for next call

        if pi_digit == '.':
            print("Wow, your actualy looking at the logs, Why? Are you feeling okay?")
            print("01010111011001010010011101110010011001010010000001101110011011110010000001110011011101000111001001100001011011100110011101100101011100100111001100100000011101000110111100100000011011000110111101110110011001010000101001011001011011110111010100100000011010110110111001101111011101110010000001110100011010000110010100100000011100100111010101101100011001010111001100100000011000010110111001100100001000000111001101101111001000000110010001101111001000000100100100001010010000010010000001100110011101010110110001101100001000000110001101101111011011010110110101101001011101000110110101100101011011100111010000100111011100110010000001110111011010000110000101110100001000000100100100100111011011010010000001110100011010000110100101101110011010110110100101101110001001110010000001101111011001100000101001011001011011110111010100100000011101110110111101110101011011000110010001101110001001110111010000100000011001110110010101110100001000000111010001101000011010010111001100100000011001100111001001101111011011010010000001100001011011100111100100100000011011110111010001101000011001010111001000100000011001110111010101111001000010100100100100100000011010100111010101110011011101000010000001110111011000010110111001101110011000010010000001110100011001010110110001101100001000000111100101101111011101010010000001101000011011110111011100100000010010010010011101101101001000000110011001100101011001010110110001101001011011100110011100001010010001110110111101110100011101000110000100100000011011010110000101101011011001010010000001111001011011110111010100100000011101010110111001100100011001010111001001110011011101000110000101101110011001000000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001100111011010010111011001100101001000000111100101101111011101010010000001110101011100000010110000100000011011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011011000110010101110100001000000111100101101111011101010010000001100100011011110111011101101110000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111001001110101011011100010000001100001011100100110111101110101011011100110010000100000011000010110111001100100001000000110010001100101011100110110010101110010011101000010000001111001011011110111010100001010010011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011011010110000101101011011001010010000001111001011011110111010100100000011000110111001001111001001011000010000001101110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001110011011000010111100100100000011001110110111101101111011001000110001001111001011001010000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001110100011001010110110001101100001000000110000100100000011011000110100101100101001000000110000101101110011001000010000001101000011101010111001001110100001000000111100101101111011101010000101001010111011001010010011101110110011001010010000001101011011011100110111101110111011011100010000001100101011000010110001101101000001000000110111101110100011010000110010101110010001000000110011001101111011100100010000001110011011011110010000001101100011011110110111001100111000010100101100101101111011101010111001000100000011010000110010101100001011100100111010000100111011100110010000001100010011001010110010101101110001000000110000101100011011010000110100101101110011001110010110000100000011000100111010101110100001000000111100101101111011101010010011101110010011001010010000001110100011011110110111100100000011100110110100001111001001000000111010001101111001000000111001101100001011110010010000001101001011101000000101001001001011011100111001101101001011001000110010100101100001000000111011101100101001000000110001001101111011101000110100000100000011010110110111001101111011101110010000001110111011010000110000101110100001001110111001100100000011000100110010101100101011011100010000001100111011011110110100101101110011001110010000001101111011011100000101001010111011001010010000001101011011011100110111101110111001000000111010001101000011001010010000001100111011000010110110101100101001000000110000101101110011001000010000001110111011001010010011101110010011001010010000001100111011011110110111001101110011000010010000001110000011011000110000101111001001000000110100101110100000010100100000101101110011001000010000001101001011001100010000001111001011011110111010100100000011000010111001101101011001000000110110101100101001000000110100001101111011101110010000001001001001001110110110100100000011001100110010101100101011011000110100101101110011001110000101001000100011011110110111000100111011101000010000001110100011001010110110001101100001000000110110101100101001000000111100101101111011101010010011101110010011001010010000001110100011011110110111100100000011000100110110001101001011011100110010000100000011101000110111100100000011100110110010101100101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000110011101101001011101100110010100100000011110010110111101110101001000000111010101110000001011000010000001101110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101100011001010111010000100000011110010110111101110101001000000110010001101111011101110110111000001010010011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011100100111010101101110001000000110000101110010011011110111010101101110011001000010000001100001011011100110010000100000011001000110010101110011011001010111001001110100001000000111100101101111011101010000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101101011000010110101101100101001000000111100101101111011101010010000001100011011100100111100100101100001000000110111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111001101100001011110010010000001100111011011110110111101100100011000100111100101100101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111010001100101011011000110110000100000011000010010000001101100011010010110010100100000011000010110111001100100001000000110100001110101011100100111010000100000011110010110111101110101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000110011101101001011101100110010100100000011110010110111101110101001000000111010101110000001011000010000001101110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101100011001010111010000100000011110010110111101110101001000000110010001101111011101110110111000001010010011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011100100111010101101110001000000110000101110010011011110111010101101110011001000010000001100001011011100110010000100000011001000110010101110011011001010111001001110100001000000111100101101111011101010000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101101011000010110101101100101001000000111100101101111011101010010000001100011011100100111100100101100001000000110111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111001101100001011110010010000001100111011011110110111101100100011000100111100101100101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111010001100101011011000110110000100000011000010010000001101100011010010110010100100000011000010110111001100100001000000110100001110101011100100111010000100000011110010110111101110101000010100101011101100101001001110111011001100101001000000110101101101110011011110111011101101110001000000110010101100001011000110110100000100000011011110111010001101000011001010111001000100000011001100110111101110010001000000111001101101111001000000110110001101111011011100110011100001010010110010110111101110101011100100010000001101000011001010110000101110010011101000010011101110011001000000110001001100101011001010110111000100000011000010110001101101000011010010110111001100111001011000010000001100010011101010111010000100000011110010110111101110101001001110111001001100101001000000111010001101111011011110010000001110011011010000111100100100000011101000110111100100000011100110110000101111001001000000110100101110100000010100100100101101110011100110110100101100100011001010010110000100000011101110110010100100000011000100110111101110100011010000010000001101011011011100110111101110111001000000111011101101000011000010111010000100111011100110010000001100010011001010110010101101110001000000110011101101111011010010110111001100111001000000110111101101110000010100101011101100101001000000110101101101110011011110111011100100000011101000110100001100101001000000110011101100001011011010110010100100000011000010110111001100100001000000111011101100101001001110111001001100101001000000110011101101111011011100110111001100001001000000111000001101100011000010111100100100000011010010111010000001010010010010010000001101010011101010111001101110100001000000111011101100001011011100110111001100001001000000111010001100101011011000110110000100000011110010110111101110101001000000110100001101111011101110010000001001001001001110110110100100000011001100110010101100101011011000110100101101110011001110000101001000111011011110111010001110100011000010010000001101101011000010110101101100101001000000111100101101111011101010010000001110101011011100110010001100101011100100111001101110100011000010110111001100100000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000110011101101001011101100110010100100000011110010110111101110101001000000111010101110000001011000010000001101110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101100011001010111010000100000011110010110111101110101001000000110010001101111011101110110111000001010010011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011100100111010101101110001000000110000101110010011011110111010101101110011001000010000001100001011011100110010000100000011001000110010101110011011001010111001001110100001000000111100101101111011101010000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101101011000010110101101100101001000000111100101101111011101010010000001100011011100100111100100101100001000000110111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111001101100001011110010010000001100111011011110110111101100100011000100111100101100101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111010001100101011011000110110000100000011000010010000001101100011010010110010100100000011000010110111001100100001000000110100001110101011100100111010000100000011110010110111101110101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000110011101101001011101100110010100100000011110010110111101110101001000000111010101110000001011000010000001101110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101100011001010111010000100000011110010110111101110101001000000110010001101111011101110110111000001010010011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011100100111010101101110001000000110000101110010011011110111010101101110011001000010000001100001011011100110010000100000011001000110010101110011011001010111001001110100001000000111100101101111011101010000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101101011000010110101101100101001000000111100101101111011101010010000001100011011100100111100100101100001000000110111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111001101100001011110010010000001100111011011110110111101100100011000100111100101100101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111010001100101011011000110110000100000011000010010000001101100011010010110010100100000011000010110111001100100001000000110100001110101011100100111010000100000011110010110111101110101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000110011101101001011101100110010100100000011110010110111101110101001000000111010101110000001011000010000001101110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101100011001010111010000100000011110010110111101110101001000000110010001101111011101110110111000001010010011100110010101110110011001010111001000100000011001110110111101101110011011100110000100100000011100100111010101101110001000000110000101110010011011110111010101101110011001000010000001100001011011100110010000100000011001000110010101110011011001010111001001110100001000000111100101101111011101010000101001001110011001010111011001100101011100100010000001100111011011110110111001101110011000010010000001101101011000010110101101100101001000000111100101101111011101010010000001100011011100100111100100101100001000000110111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111001101100001011110010010000001100111011011110110111101100100011000100111100101100101000010100100111001100101011101100110010101110010001000000110011101101111011011100110111001100001001000000111010001100101011011000110110000100000011000010010000001101100011010010110010100100000011000010110111001100100001000000110100001110101011100100111010000100000011110010110111101110101")
        if pi_digit == '0':  # Compare to string '1', not integer 1
            k.press("w")
            t.sleep(0.1)
            k.release("w")
        
        if pi_digit == '1':  # Compare to string '1', not integer 1
            k.press("a")
            t.sleep(0.1)
            k.release("a")
            
        if pi_digit == '2':  # Compare to string '1', not integer 1
            k.press("s")
            t.sleep(0.1)
            k.release("s")
        
        if pi_digit == '3':  # Compare to string '1', not integer 1
            k.press("d")
            t.sleep(0.1)
            k.release("d")

        if pi_digit == '4':  # Compare to string '1', not integer 1
            k.press("q")
            t.sleep(0.1)
            k.release("q")

        if pi_digit == '5':  # Compare to string '1', not integer 1
            k.press("e")
            t.sleep(0.1)
            k.release("e")

        if pi_digit == '6':  # Compare to string '1', not integer 1
            k.press("z")
            t.sleep(0.1)
            k.release("z")

        if pi_digit == '7':  # Compare to string '1', not integer 1
            k.press("x")
            t.sleep(0.1)
            k.release("x")

        if pi_digit == '8':  # Compare to string '1', not integer 1
            k.press("c")
            t.sleep(0.1)
            k.release("c")

        if pi_digit == '9':  # Compare to string '1', not integer 1
            k.press("v")
            t.sleep(0.1)
            k.release("v")

        t.sleep(1)  # Small delay between checks

# Main code
pi_file_path = "pi.txt"
pi_map = digit_gather(pi_file_path)  # Use the pi_file_path variable
current_position = 0

# Start the program
start()
